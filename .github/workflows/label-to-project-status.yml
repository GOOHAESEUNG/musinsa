name: Update Project Status by Label

on:
  issues:
    types: [labeled]

jobs:
  update-project-status:
    runs-on: ubuntu-latest
    steps:
      - name: Check label and update project status
        uses: actions/github-script@v7
        with:
          github-token: ${{ secrets.GH_PROJECT_TOKEN }}
          script: |
            const label = context.payload.label.name;
            const issueNodeId = context.payload.issue.node_id;

            const PROJECT_NUMBER = 1; // ë„ˆì˜ Project ë²ˆí˜¸
            const ORG = 'ì‚¬ìš©ìëª… ë˜ëŠ” ì¡°ì§ëª…'; // ì˜ˆ: 'haeseung-musinsa'
            const FIELD_ID = 'í•„ë“œ ID'; // Status í•„ë“œ ID
            const STATUS_VALUES = {
              "ğŸš§ ì§„í–‰ ì¤‘": "ì¸í”„ë¡œê·¸ë ˆìŠ¤ ID",
              "âœ… ì™„ë£Œë¨": "ë˜ ID"
            };

            if (!STATUS_VALUES[label]) {
              console.log(`í•´ë‹¹ ë¼ë²¨ì€ ìë™ì²˜ë¦¬ ëŒ€ìƒì´ ì•„ë‹˜: ${label}`);
              return;
            }

            const { data: projects } = await github.graphql(`
              query {
                organization(login: "${ORG}") {
                  projectV2(number: ${PROJECT_NUMBER}) {
                    id
                  }
                }
              }
            `);

            const projectId = projects.organization.projectV2.id;
            console.log("âœ… Project ID:", projectId);

            await github.graphql(`
              mutation {
                updateProjectV2ItemFieldValue(
                  input: {
                    projectId: "${projectId}"
                    itemId: "${issueNodeId}"
                    fieldId: "${FIELD_ID}"
                    value: {
                      singleSelectOptionId: "${STATUS_VALUES[label]}"
                    }
                  }
                ) {
                  projectV2Item {
                    id
                  }
                }
              }
            `);