name: Update Project Status by Label

on:
  issues:
    types: [labeled]

jobs:
  update-project-status:
    runs-on: ubuntu-latest
    steps:
      - name: Check label and update project status
        uses: actions/github-script@v7
        with:
          github-token: ${{ secrets.GH_PROJECT_TOKEN }}
          script: |
            const label = context.payload.label.name;
            const issueNodeId = context.payload.issue.node_id;

            const PROJECT_NUMBER = 1;
            const ORG = 'GOOHAESEUNG';
            const FIELD_ID = 'PVT_FIELD_abc123';
            const STATUS_VALUES = {
              "üöß ÏßÑÌñâ Ï§ë": "OPTION_inprogress_456",
              "‚úÖ ÏôÑÎ£åÎê®": "OPTION_done_789"
            };

            if (!STATUS_VALUES[label]) {
              console.log(`Ìï¥Îãπ ÎùºÎ≤®ÏùÄ ÏûêÎèôÏ≤òÎ¶¨ ÎåÄÏÉÅÏù¥ ÏïÑÎãò: ${label}`);
              return;
            }

            const { user } = await github.graphql(`
              query {
                user(login: "${ORG}") {
                  projectV2(number: ${PROJECT_NUMBER}) {
                    id
                  }
                }
              }
            `);

            const projectId = user.projectV2.id;
            console.log("‚úÖ Project ID:", projectId);

            await github.graphql(`
              mutation {
                updateProjectV2ItemFieldValue(
                  input: {
                    projectId: "${projectId}"
                    itemId: "${issueNodeId}"
                    fieldId: "${FIELD_ID}"
                    value: {
                      singleSelectOptionId: "${STATUS_VALUES[label]}"
                    }
                  }
                ) {
                  projectV2Item {
                    id
                  }
                }
              }
            `);